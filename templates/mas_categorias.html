{% load static %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="{% static 'css/global.css' %}">
<link rel="stylesheet" href="{% static 'css/mas_personajes.css' %}">

<body>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card-character-mas p-4 shadow">

                <h3 class="text-center mb-4">
                    {% if categoria %} Editar Categoría {% else %} Nueva Categoría {% endif %}
                </h3>

                <form method="POST" action="

                        {% if categoria %}{% url 'editar_categoria' categoria.code %}{% else %}{% url 'mas_categorias' %}{% endif %}">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label class="form-label fw-bold">Código de Categoría:</label>
                        <input type="number" name="code"
                               value="{% if categoria %}{{ categoria.code }}{% else %}{{ siguiente_codigo }}{% endif %}"
                               class="form-control border-dark bg-light" readonly>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Nombre de la Categoría:</label>
                        <input type="text" name="name" class="form-control border-dark"
                               value="{{ categoria.name|default:'' }}"
                               placeholder="Ej: Secundarios de Lujo" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Descripción:</label>
                        <textarea name="description" class="form-control border-dark" rows="3"
                                  placeholder="Ej: Personajes que no salen siempre..."
                                  required>{{ categoria.description|default:'' }}</textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">URL de la Imagen:</label>
                        <input type="text" name="image" class="form-control border-dark"
                               value="{{ categoria.image|default:'' }}"
                               placeholder="Ej: https://..." required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Selecciona los personajes:</label>
                        <div class="personajes-scroll-container"
                             style="max-height: 250px; overflow-y: auto; border: 2px solid #ffd300; background: #fff; padding: 10px; border-radius: 5px;">
                            <div class="row g-2">
                                {% for p in personajes %}
                                    <div class="col-6">
                                        <div class="form-check d-flex align-items-center gap-2 border p-1 rounded">
                                            <input class="form-check-input ms-1" type="checkbox" name="personajes_ids"
                                                   value="{{ p.code }}" id="p-{{ p.code }}"
                                                   {% if categoria and p.code in categoria.characters %}checked{% endif %}>

                                            <label class="form-check-label d-flex align-items-center"
                                                   for="p-{{ p.code }}" style="cursor: pointer; font-size: 0.85rem;">
                                                <img src="

                                                        {% if 'http' in p.image %}{{ p.image }}{% else %}https://cdn.thesimpsonsapi.com/500{{ p.image }}{% endif %}"
                                                     alt="{{ p.name }}"
                                                     style="width: 35px; height: 35px; object-fit: contain; margin-right: 8px;">
                                                {{ p.name }}
                                            </label>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div class="text-center mt-4 d-flex gap-2">
                        <button type="submit" class="btn-simpson w-100">
                            {% if categoria %} Guardar Cambios {% else %} Crear Categoría {% endif %}
                        </button>
                        <a href="{% url 'gestion' %}" class="btn-simpson w-100" style="background-color: #6c757d;">Cancelar</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
